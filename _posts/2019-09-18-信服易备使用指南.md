---
layout: post
title: '信服易备使用指南'
date: 2019-07-19
author: gyx
color: rgb(233,0,233)
tags: Vue
---

### 1、一键接管

一键接管包含四部分：数据库、虚拟机、应用服务器、灾备演练
接管即是实现实时同步的过程。

**1.1 数据库**

两台机器上的同名数据库实现实时同步，数据库的角色为一主一备，当主库出现故障时，
可以将备库角色切换为主库，用原备库临时顶替原主库。

1.1.1 添加接管环境步骤如下：
1、在系统管理——设备管理内，添加需要进行灾备接管的生产服务器
参见步骤 **设备管理**
2、添加需要接管的生产数据库/实例
参见步骤**添加数据库**
3、在列表页，点击右上角一键接管按钮，进入一键接管配置页面，可查看所有一键接管设备信息

1.1.2 初始化步骤如下：
1、在一键接管页面，点击添加 ；填写接管信息；主设备为生产设备，备设备为易备设备，端口号为数据库默认端口号
>注：如果一台服务器上有多个库需要接管，输入用户名密码后，点击保持锁定。如果多个库使用不同的用户名密码，则分开填写。

2、配置好之后，点击确定
箭头为橙色：正在进行初始化
箭头为绿色：同步正常，可接管。
其他情况为数据同步失败，点击查看详情可跳转至连接详情页，查看详细操作

1.1.3 切换步骤如下
切换分为实例切换和IP切换。生产发生故障时，先进行实例切换，切换成功后再进行IP切换。
1、单数据库切换：生产环境故障时，将业务转移到易备环境
步骤：点击【切换数据库】，输入用户密码，对当前实例进行切换

2、多数据库切换：生产环境故障时，将业务转移到易备环境
步骤：点击【切备】，输入用户密码，即可以对服务器所有实例进行切换

3、单数据库回切：当生产故障恢复后，需要将业务重新转移到生产环境时，则进行回切。
回切首先会将故障期间，备库的数据同步到主库。
步骤：点击【切换数据库】，输入用户密码

4、多数据库回切：当生产故障恢复后，需要将业务重新转移到生产环境时，则进行回切。
回切首先会将故障期间，备库的数据同步到主库。
步骤：点击【切主】，输入用户密码
5、IP切换（在生产环境和易备环境设备均正常的情况下做的操作）
1）Windows系统：将生产环境设备的物理IP和易备环境设备的物理IP对调；
2）Linux系统：将生产环境设备上的服务IP（对外提供主服务的IP）给down掉，然后添加到易备环境设备上，生产环境和易备环境原来还存在的IP不会发生变化；
步骤：点击【切IP】，输入用户密码
注：IP切换属于设备层面，不涉及数据库sql的执行
6、IP回切
1）Windows系统：将生产环境设备的物理IP和易备环境设备的物理IP对调；
2）Linux系统：服务IP从易备设备回切到生产设备上
步骤：点击【切IP】，输入用户名密码， 
7、解除连接
输入用户操作密码，即可解除一键接管

当单实例生产库故障时，切换步骤为：1→5→3→6
当多实例生产库故障时，切换步骤为：2→5→4→6

1.1.4 批量切换
初始化成功后，点击批量切换按钮，可批量添加操作计划，检验各个数据库的连接是否正常；
成功添加计划后，立即跳转至灾备演练切换详情页，在该页面可查看操作详情；
在一键接管页面可看到设备状态随之改变

**1.2 虚拟机**
虚拟机可以查看所有配置了一键接管的虚拟机，并进行切换操作
1.2.1 接管初始化操作
添加虚拟机一键接管有从虚拟机主机管理界面进入和从VMware列表进入两种入口。
1.2.1.1从虚拟主机管理界面进入
1）展开主机信息详情，选择要进行接管的虚拟机（多选/单选）。
2）点击已选虚拟机进入已选列表
3）点击接管初始化，弹出同步初始化配置框。
填写要求
*表示必填
同步主机：选择接管的同步虚拟机存放主机位置 
同步磁盘：选择接管的同步虚拟机存储的磁盘位置
虚拟机IP：此IP为记录信息，不影响接管同步出来的虚拟机IP（同步虚拟机IP与源虚拟机IP一致） 
同步策略：五种策略可选择

1.2.1.2从VMware列表进入
进入VMware列表，选择要进行接管的虚拟机（多选/单选），点击【查看已选虚拟机】查看已选列表
1）点击接管初始化，弹出同步初始化配置框。
填写要求
*表示必填
同步主机：选择接管的同步虚拟机存放主机位置 
同步磁盘：选择接管的同步虚拟机存储的磁盘位置
虚拟机IP：此IP为记录信息，不影响接管同步出来的虚拟机IP（同步虚拟机IP与源虚拟机IP一致） 
同步策略：五种策略可选择
2）配置好之后，点击确定
跳转至VMware一键接管页面，源虚拟机会进行一次全备，并复制出一台同步虚拟机

1.2.2功能操作
1）故障转移：当源虚拟机故障时，启用同步虚拟机，将业务转移到同步虚拟机
步骤：点击【故障转移】，确认源虚拟机已关闭，选择已成功备份时间点，点击确认后启用同步虚拟机
2）故障恢复：当源虚拟机恢复后，将业务恢复到源虚拟机，并关闭同步虚拟机
步骤：点击【故障恢复】，选择已成功备份时间点，点击确认后，将业务成功恢复到源虚拟机
3）修改策略：在接管过程中，可修改接管同步策略
步骤：点击【修改策略】，选择要修改的策略，点击确定 

1.3 应用服务器
1.3.1 初始化步骤
1）点击“一键接管”按钮，进入到首页_应用服务器_一键接管配置页面。
2）点击添加，弹出接管初始化配置页面
选择主设备：为生产设备
选择备设备：为易备设备
应用服务器：为添加服务器
用户密码：当前使用用户的密码
3）配置好后，点击确定
箭头为黄色：正在初始化或同步异常
箭头为绿色：同步正常，可接管。
其他情况为数据同步失败。
查看详情可跳转至连接详情页，查看连接详细信息，以及操作记录

1.3.2 切换步骤
切换分为【切IP】和【单切IP】功能。
Windows系统：将生产环境设备的物理IP和易备环境设备的物理IP对调；
Linux系统：将生产环境设备上的服务IP（对外提供主服务的IP）给down掉，然后添加到易备环境设备上，生产环境和易备环境原来还存在的IP不会发生变化；
1.3.2.1 切IP
切IP是在生产设备和易备设备均正常情况下，进行切换服务IP，将业务转移到易备环境上。
1）点击【切IP】后，需要输入当前使用用户的密码来执行操作
2）点击“查看详情”可跳转至连接详情页查看操作详情

1.3.2.2 单切IP
当生产发生故障时，进行单切IP，将业务转移到易备环境上。
注：成功切换后，服务IP切换至易备设备上，连接状态显示异常。生产设备恢复正常后，可再次进行切IP操作，恢复正常业务。

1.4 灾备演练
为方便切换实例和切IP的批量操作，同时也是为了检验各个数据库的连接是否正常，特做灾备演练的功能；
步骤
1）点击右上角添加按钮添加灾备演练计划
2）输出计划名称及用户密码，点击确定，成功添加计划并立即执行
3）成功添加的灾备演练计划会出现在列表中，点击计划名称可跳转至详情页 ，查看详细操作
