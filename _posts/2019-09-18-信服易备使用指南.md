---
layout: post
title: '信服易备使用指南'
date: 2019-07-19
author: gyx
color: rgb(233,0,233)
tags: Vue
---

### 1、一键接管

一键接管包含四部分：数据库、虚拟机、应用服务器、灾备演练
接管即是实现实时同步的过程。

**1.1 数据库**

两台机器上的同名数据库实现实时同步，数据库的角色为一主一备，当主库出现故障时，
可以将备库角色切换为主库，用原备库临时顶替原主库。

1.1.1 添加接管环境步骤如下：
1、在系统管理——设备管理内，添加需要进行灾备接管的生产服务器
参见步骤 **系统管理_设备管理**
2、添加需要接管的生产数据库/实例
参见步骤**数据库数据保护_添加数据库**
3、在列表页，点击右上角一键接管按钮，进入一键接管配置页面，可查看所有一键接管设备信息

1.1.2 初始化步骤如下：
1、在一键接管页面，点击添加 ；填写接管信息；主设备为生产设备，备设备为易备设备，端口号为数据库默认端口号
>注：如果一台服务器上有多个库需要接管，输入用户名密码后，点击保持锁定。如果多个库使用不同的用户名密码，则分开填写。

2、配置好之后，点击确定
箭头为橙色：正在进行初始化
箭头为绿色：同步正常，可接管。
其他情况为数据同步失败，点击查看详情可跳转至连接详情页，查看详细操作

1.1.3 切换步骤如下
切换分为实例切换和IP切换。生产发生故障时，先进行实例切换，切换成功后再进行IP切换。
1、单数据库切换：生产环境故障时，将业务转移到易备环境
步骤：点击【切换数据库】，输入用户密码，对当前实例进行切换

2、多数据库切换：生产环境故障时，将业务转移到易备环境
步骤：点击【切备】，输入用户密码，即可以对服务器所有实例进行切换

3、单数据库回切：当生产故障恢复后，需要将业务重新转移到生产环境时，则进行回切。
回切首先会将故障期间，备库的数据同步到主库。
步骤：点击【切换数据库】，输入用户密码

4、多数据库回切：当生产故障恢复后，需要将业务重新转移到生产环境时，则进行回切。
回切首先会将故障期间，备库的数据同步到主库。
步骤：点击【切主】，输入用户密码
5、IP切换（在生产环境和易备环境设备均正常的情况下做的操作）
1）Windows系统：将生产环境设备的物理IP和易备环境设备的物理IP对调；
2）Linux系统：将生产环境设备上的服务IP（对外提供主服务的IP）给down掉，然后添加到易备环境设备上，生产环境和易备环境原来还存在的IP不会发生变化；
步骤：点击【切IP】，输入用户密码
注：IP切换属于设备层面，不涉及数据库sql的执行
6、IP回切
1）Windows系统：将生产环境设备的物理IP和易备环境设备的物理IP对调；
2）Linux系统：服务IP从易备设备回切到生产设备上
步骤：点击【切IP】，输入用户名密码， 
7、解除连接
输入用户操作密码，即可解除一键接管

当单实例生产库故障时，切换步骤为：1→5→3→6
当多实例生产库故障时，切换步骤为：2→5→4→6

1.1.4 批量切换
初始化成功后，点击批量切换按钮，可批量添加操作计划，检验各个数据库的连接是否正常；
成功添加计划后，立即跳转至灾备演练切换详情页，在该页面可查看操作详情；
在一键接管页面可看到设备状态随之改变

**1.2 虚拟机**
虚拟机可以查看所有配置了一键接管的虚拟机，并进行切换操作
1.2.1 接管初始化操作
添加虚拟机一键接管有从虚拟机主机管理界面进入和从VMware列表进入两种入口。
1.2.1.1从虚拟主机管理界面进入
1）展开主机信息详情，选择要进行接管的虚拟机（多选/单选）。
2）点击已选虚拟机进入已选列表
3）点击接管初始化，弹出同步初始化配置框。
填写要求
*表示必填
同步主机：选择接管的同步虚拟机存放主机位置 
同步磁盘：选择接管的同步虚拟机存储的磁盘位置
虚拟机IP：此IP为记录信息，不影响接管同步出来的虚拟机IP（同步虚拟机IP与源虚拟机IP一致） 
同步策略：五种策略可选择

1.2.1.2从VMware列表进入
进入VMware列表，选择要进行接管的虚拟机（多选/单选），点击【查看已选虚拟机】查看已选列表
1）点击接管初始化，弹出同步初始化配置框。
填写要求
*表示必填
同步主机：选择接管的同步虚拟机存放主机位置 
同步磁盘：选择接管的同步虚拟机存储的磁盘位置
虚拟机IP：此IP为记录信息，不影响接管同步出来的虚拟机IP（同步虚拟机IP与源虚拟机IP一致） 
同步策略：五种策略可选择
2）配置好之后，点击确定
跳转至VMware一键接管页面，源虚拟机会进行一次全备，并复制出一台同步虚拟机

1.2.2功能操作
1）故障转移：当源虚拟机故障时，启用同步虚拟机，将业务转移到同步虚拟机
步骤：点击【故障转移】，确认源虚拟机已关闭，选择已成功备份时间点，点击确认后启用同步虚拟机
2）故障恢复：当源虚拟机恢复后，将业务恢复到源虚拟机，并关闭同步虚拟机
步骤：点击【故障恢复】，选择已成功备份时间点，点击确认后，将业务成功恢复到源虚拟机
3）修改策略：在接管过程中，可修改接管同步策略
步骤：点击【修改策略】，选择要修改的策略，点击确定 

**1.3 应用服务器**
1.3.1 初始化步骤
1）点击“一键接管”按钮，进入到首页_应用服务器_一键接管配置页面。
2）点击添加，弹出接管初始化配置页面
选择主设备：为生产设备
选择备设备：为易备设备
应用服务器：为添加服务器
用户密码：当前使用用户的密码
3）配置好后，点击确定
箭头为黄色：正在初始化或同步异常
箭头为绿色：同步正常，可接管。
其他情况为数据同步失败。
查看详情可跳转至连接详情页，查看连接详细信息，以及操作记录

1.3.2 切换步骤
切换分为【切IP】和【单切IP】功能。
Windows系统：将生产环境设备的物理IP和易备环境设备的物理IP对调；
Linux系统：将生产环境设备上的服务IP（对外提供主服务的IP）给down掉，然后添加到易备环境设备上，生产环境和易备环境原来还存在的IP不会发生变化；
1.3.2.1 切IP
切IP是在生产设备和易备设备均正常情况下，进行切换服务IP，将业务转移到易备环境上。
1）点击【切IP】后，需要输入当前使用用户的密码来执行操作
2）点击“查看详情”可跳转至连接详情页查看操作详情

1.3.2.2 单切IP
当生产发生故障时，进行单切IP，将业务转移到易备环境上。
注：成功切换后，服务IP切换至易备设备上，连接状态显示异常。生产设备恢复正常后，可再次进行切IP操作，恢复正常业务。

**1.4 灾备演练**
为方便切换实例和切IP的批量操作，同时也是为了检验各个数据库的连接是否正常，特做灾备演练的功能；
步骤
1）点击右上角添加按钮添加灾备演练计划
2）输出计划名称及用户密码，点击确定，成功添加计划并立即执行
3）成功添加的灾备演练计划会出现在列表中，点击计划名称可跳转至详情页 ，查看详细操作


### 2、文件系统数据库保护
用于进行文件系统的备份、恢复操作。选择windows和linux，可以查看不同类型的服务器列表。
**2.1 添加、修改及删除服务器**
添加
1）在文件服务器列表页面，点击添加按钮
2）*项为必填项。添加成功后，在列表中可以看到所添加的服务器
主机IP：为服务器物理IP
操作系统：Windows/Linux可选择
服务器登录名、登录密码据实填写。
修改
1）点击记录后的修改按钮，可对别名、主机IP、操作系统、所属业务系统进行修改。主机名根据服务器自动识别。
删除
1）点击记录后的删除按钮
2）弹出确认删除弹框，点击弹框内确定，即可成功删除

**2.2 备份**
是对服务器中的数据进行备份，作为恢复的数据来源
1）点击列表内的服务器名
2）进入服务器详情页，点击添加备份计划
备份计划名称：自定义填写
备份类型：三种类型，根据需求选择。文件备份可选择1-3个文件夹同时进行备份，支持排除文件（识别文件名+后缀名进行排除，如：test.xlsx、*.txt、*.png）、限速备份功能
备份策略：文件备份类型有同步/增量不删减，可选择；卷备份/系统备份只有同步策略
备份时间：
类型	        备份时间选择
单次备份	    单次
按分钟循环	选择备份时间间隔10分钟—60分钟
按小时循环	选择备份时间间隔1小时—24小时
按天循环	    选择每天一个/多个时间点备份
按周循环	    选择周一至周日一天/几天，一个/多个时间点备份
按月循环	    选择具体一个日期/多个日期，一个/多个时间点备份
立即	        选择后点击确定立即开始备份
执行时间：自定义计划开始时间
3）备份成功后，进入备份记录查看，可展开查看详情

**2.3 恢复**
实现即时恢复
1）通过备份记录目录选择需要恢复的记录，点击查看详情
2）点击备份集后的恢复，弹出执行恢复操作弹框，进行填写
计划名：自定义填写
恢复主机：为添加的服务器，支持同机/异机恢复
恢复源路径：为备份成功文件，可从中选择要恢复的文件，支持1-3个文件夹同时进行恢复
存放路径：为服务器下路径，自定义选择
恢复排除文件：同备份排除文件规则
服务器登录名、密码据实填写，正确填写完成后，点击“确定”按钮，立即开始恢复
3）可在“操作计划_恢复计划”中查看执行计划状态，“恢复记录”中查看结果

**2.4 终止计划**
服务器下的备份恢复任务，正常进行中/异常卡死时，点击列表内的服务器名进入服务器详情页面，点击右上角终止计划按钮，进行二次确认后，计划将被中断，中断后可进行删除计划操作。
注：循环备份计划，只能中断当次备份，下个循环时间点会再进行备份。

### 3.数据库数据保护
实现对数据库的数据保护，包括数据库定时备份、恢复演练等功能
**3.1添加数据库**
1)首先在“系统管理_设备管理”里面，添加数据库生产/易备服务器，详见系统管理_设备管理
2)再点击“数据库”，选择数据库类型
3）可点击添加/批量添加按钮（目前只有SQL Server和InSql具有批量添加功能）
*部分为必填项
1.点击【添加】按钮后，弹出显示框，进行填写
名称：自定义填写，不能包含空格
所属设备：先在“系统管理_设备管理”内添加数据库所属生产服务器，添加后可进行选择
数据库名、端口号、数据库登录名、数据库密码据实填写。

2.点击【批量添加】按钮后，弹出显示框，进行填写
所属设备：选择一个设备
端口号、数据库登录名、数据库密码据实填写
信息填写完成后点击【扫描数据库】，显示该设备下所有数据库，可全选/单选进行快速添加

**3.2 修改、删除数据库**
3.2.1 修改
点击数据库列表右侧的修改图标，可修改名称、数据库名、端口号、数据库登录名、数据库密码和所属业务系统。
3.2.2 删除
点击数据库列表右侧的删除图标，弹出确认删除弹框，点击弹框内“确定”，即可完成删除

**3.3 备份**
1）点击列表内的数据库名称
2）进入数据库详情页，点击“添加计划”，可选择“备份计划”或“恢复计划”，选择备份计划
备份计划名称：自定义填写
备份策略：所有数据库均提供“全备+增备”策略，Oracle数据库还提供CDB持续备份策略可选，SQL Server还提供“全备+日志备份”策略可选。

1.选择全备+增备时，时间策略：
类型	      备份时间选择
单次备份	  单次
小时	      选择备份时间间隔1小时——24小时
天	      选择每天一个/多个时间点备份
周	      周一至周日选择一天/几天，一个/多个时间点备份
月	      选择具体一个日期/多个日期，一个/多个时间点备份
执行时间：自定义计划开始时间
2.选择全备+日志备份时，时间策略为按分钟循环，可选择10分钟—60分钟。
3.选择CDB持续备份时，时间策略可选按天、周、月循环。备份粒度可选5-60分钟。

**3.4 恢复**
恢复方式分两种，实时恢复和计划恢复。两种恢复方式都属于异机恢复。
3.4.1 实时恢复
1）通过“备份集”目录进入，根据备份集时间，点击备份集右侧“恢复”
2）弹出实时恢复执行框，填写正确，点击确定后立即开始恢复
恢复设备：先在“系统管理_设备管理”内添加数据库所属易备服务器，添加后可进行选择
数据库名、端口号默认为备份数据库名和端口号
3）在“操作计划_恢复计划”内可查看所有恢复计划信息

3.4.2 计划恢复
恢复演练默认使用最新的备份集恢复
1）点击“添加计划”，选择恢复计划
计划名称：自定义填写
恢复设备：先在“系统管理_设备管理”内添加数据库所属易备服务器，添加后可进行选择
数据库名、端口号默认为备份数据库名和端口号
时间策略： 
类型	   恢复时间选择
单次	   单次
周	   周一至周日选择一天/几天，一个/多个时间点恢复
月	   选择具体一个日期/多个日期，一个/多个时间点恢复
恢复时间：自定义计划开始时间

**3.5 一键接管**
目前Oracle、SQL Server、MySql、InSql均有一键接管功能。具体参见**一键接管**

**3.6 监控**
若已在监控端添加该数据库，则可以跳转至监控该数据库详情界面，若未在监控端添加此数据库，则无法跳转至监控界面，会有异常提示。
1）点击数据库列表右侧的监控图标，即可跳转至监控该数据库的详情页
注：目前Oracle、SQL Server数据库均支持该功能

### 4.虚拟机数据保护
目前可对VMware、华为虚拟机、Hyper-V类型的虚拟机进行保护
**4.1 添加虚拟机管理设备**
参见**系统管理_设备管理**,选择使用类别为虚拟机，然后据实填写相关信息
**4.2 虚拟机主机管理**
4.2.1 添加主机
1）点击添加主机，弹出添加弹框
主机名：自定义填写
选择设备：先在“系统管理_设备管理”内添加管理虚拟机主机设备所属生产服务器，添加后可进行选择
主机IP：据实填写需要管理的虚拟机主机ip
登录账号、密码：据实填写
主机类型：据实选择
2）点击确定即可添加主机，成功添加主机后，可进行扫描，删除等操作

**4.3 备份**
可制定多虚拟机同时备份计划和单虚拟机备份计划
4.3.1 多虚拟备份计划
添加虚拟机备份计划有从虚拟机主机管理界面进入和从VMware列表/华为虚拟机列表/Hyper-V列表进入两种入口。
4.3.1.1 从虚拟主机管理页面进入
1）展开主机信息详情，选择相应的虚拟机（多选/单选）。点击已选虚拟机进入已选列表
2）点击添加备份计划，弹出添加备份计划框。单个虚拟机备份时可直接点击虚拟机名称进入虚拟机详情页，添加备份计划。

4.3.1.2 从VMware列表/华为虚拟机列表/Hyper-V列表进入
1）进入VMware列表，选择相关虚拟机（多选/单选），点击【查看已选虚拟机】查看已选列表
2）点击【添加备份计划】弹出添加备份计划框。单个虚拟机备份时可直接点击虚拟机名称进入虚拟机详情页，添加备份计划。

添加备份计划详情如下
备份计划名称：自定义填写
备份策略：全备+增备
时间策略：
类型  	 备份时间选择
单次备份	 单次
小时	     选择备份时间间隔1小时——24小时
天	     选择每天一个/多个时间点备份
周	     周一至周日选择一天/几天，一个/多个时间点备份
月	     选择具体一个日期/多个日期，一个/多个时间点备份
执行时间：自定义计划开始时间

4.3.2 单虚拟机备份计划
1）在虚拟机主机管理/XX列表点击需要进行备份的虚拟机名称，进入虚拟机详情页
2）点击添加备份计划
添加备份计划详情同上。
3）点击备份计划可查看该虚拟机相关备份计划列表
4）备份成功后，有备份开始和结束时间，备份状态正常，可展开查看详情

### 5.应用服务器保护


### 6.智能巡检


### 7.系统管理
系统管理包含三部分：设备管理、配置管理和权限管理。
**7.1 设备管理**
设备管理可对备份、接管的数据库所在服务器、虚拟机管理服务器、应用服务器进行管理，可对设备进行添加、修改、删除操作，可跳转至监控页面。
若已在监控端添加该数据库，则可以跳转至监控界面，若未在监控端添加此数据库，则无法跳转至监控界面，会有异常提示。监控配置及相关功能操作，参见监控系统V1.0-用户手册
>将服务器加入设备管理，是进行数据库备份、接管、虚拟机备份的前提。
1)点击右上角添加按钮可用于添加设备
设备名：填写易于识别的名称，如“生产HIS服务器”
设备IP：为服务器物理IP
设备类型：生产服务器，则选择生产环境；信服易备内的服务器，则选择易备环境
存储方式：NFS存储、CLOUD存储
用途类型、操作系统、windows系统版本据实选择
临时IP：没有则为空。注：一键接管，主库环境正常，需要通过临时IP中转才能交换IP
系统登录名：windows为administrator，linux为root
2）添加完成后页面展示已添加的设备，左上角可切换列表视图和卡片视图

**7.2 配置管理**
7.2.1 邮箱管理
本模块用于添加邮箱，当备份失败或一键接管故障时，向用户发送邮件。
可对邮箱进行添加、修改、删除操作。
7.2.2 存储地址
对存储地址进行管理，可进行添加、修改、删除、启用/禁用操作。
开始备份后，请尽量避免修改存储路径，以免影响恢复。
7.2.3 云存储
设置云存储地址，可进行添加、修改、删除操作。
开始备份后，请尽量避免修改存储路径，以免影响恢复。
7.2.4 存储策略
用于对保留的备份集进行管理，可自定义全备备份保留个数，可进行添加、修改、删除操作。
7.2.5 端口管理
默认使用类型端口号，可进行修改。

**7.3 权限管理**
对用户添加、删除，修改用户权限、修改用户状态等。
1）进入方式：系统管理→权限管理→用户管理
2）添加用户：点击添加用户，输入账户、密码，如果权限为空，则默认只能查看主页内容
3）邮箱：添加正确邮箱，可勾选接收使用，不勾选为不启用，需在邮箱管理里进行配置
4）修改用户：点击“编辑”，可以修改姓名和权限
5）删除用户：点击“删除”，可进行删除
6）重置密码：点击“编辑”，点击“重置密码”，重置密码默认为Xfback@201806！
7）用户禁用：点击“编辑”，选择“禁用”
带*号为必填项。权限默认为空，即拥有最低权限，只能查看主页。所选择的角色可查看主页及该角色板块，用户角色可多选。
### 8.自动化部署